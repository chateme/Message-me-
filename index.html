<!DOCTYPE html>
<html lang="ur">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>WhatsApp Nasir v26 - Dark Edition</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <style>
        :root { 
            --wa-teal: #128c7e; --wa-dark-bg: #111b21; --wa-chat-bg: #0b141a;
            --wa-sent: #005c4b; --wa-received: #202c33; --text: #e9edef;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', sans-serif; }
        
        body { background: #000; height: 100vh; display: flex; justify-content: center; color: var(--text); }

        #app-container { width: 100%; max-width: 500px; height: 100vh; background: var(--wa-dark-bg); position: relative; display: flex; flex-direction: column; overflow: hidden; border-left: 1px solid #333; border-right: 1px solid #333; }

        .screen { display: none; height: 100%; flex-direction: column; }
        .active { display: flex; }

        /* Dark Header */
        .header { background: #202c33; padding: 15px; display: flex; align-items: center; gap: 15px; height: 60px; }
        
        /* Inbox Items */
        .chat-item { display: flex; align-items: center; padding: 15px; border-bottom: 1px solid #222; cursor: pointer; }
        .chat-item:active { background: #2a3942; }
        .avatar { width: 45px; height: 45px; border-radius: 50%; background: #6a7175; display: flex; align-items: center; justify-content: center; font-size: 20px; }

        /* Chat Area */
        #chat-flow { flex: 1; overflow-y: auto; padding: 15px; background: var(--wa-chat-bg); display: flex; flex-direction: column; gap: 8px; }
        .msg { position: relative; padding: 8px 12px 18px 12px; border-radius: 8px; max-width: 85%; font-size: 14.5px; box-shadow: 0 1px 1px rgba(0,0,0,0.5); }
        .sent { background: var(--wa-sent); align-self: flex-end; border-top-right-radius: 0; }
        .received { background: var(--wa-received); align-self: flex-start; border-top-left-radius: 0; }
        .meta { position: absolute; bottom: 3px; right: 7px; font-size: 10px; color: #aebac1; }

        /* Sticker Panel */
        #sticker-panel { display: none; background: #202c33; padding: 10px; height: 200px; overflow-y: auto; }
        .sticker-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; }
        .sticker-img { width: 100%; cursor: pointer; border-radius: 5px; }

        /* Footer */
        .footer { padding: 10px; display: flex; align-items: center; background: #202c33; gap: 10px; }
        .input-group { flex: 1; background: #2a3942; border-radius: 25px; padding: 0 15px; display: flex; align-items: center; height: 42px; }
        #msg-input { flex: 1; border: none; outline: none; background: transparent; color: white; font-size: 16px; }

        /* Login Screen Style */
        .login-box { padding: 30px; display: flex; flex-direction: column; gap: 20px; margin-top: 50px; }
        .login-box input { background: #2a3942; border: 1px solid #333; padding: 15px; border-radius: 10px; color: white; outline: none; }
        .login-btn { background: #00a884; color: black; font-weight: bold; padding: 15px; border: none; border-radius: 10px; cursor: pointer; }

        .fab { position: absolute; bottom: 30px; right: 20px; background: #00a884; color: black; width: 55px; height: 55px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 24px; cursor: pointer; box-shadow: 0 4px 10px rgba(0,0,0,0.5); }
    </style>
</head>
<body>

<div id="app-container">
    
    <div id="login-screen" class="screen active">
        <div class="header"><span>WhatsApp Registration</span></div>
        <div class="login-box">
            <h2 style="text-align:center;">خوش آمدید</h2>
            <p style="color:#aebac1; font-size:13px; text-align:center;">اپنا نمبر اور نام ڈال کر رجسٹر ہوں</p>
            <input type="text" id="reg-name" placeholder="آپ کا نام">
            <input type="number" id="reg-phone" placeholder="فون نمبر (مثلاً 03001234567)">
            <button class="login-btn" onclick="registerUser()">رجسٹر ہوں</button>
        </div>
    </div>

    <div id="list-screen" class="screen">
        <div class="header"><span style="font-size: 18px; font-weight: bold;">WhatsApp</span></div>
        <div id="inbox-list" style="flex: 1; overflow-y: auto;"></div>
        <div class="fab" onclick="showNewChat()"><i class="fas fa-comment-dots"></i></div>
    </div>

    <div id="chat-screen" class="screen">
        <div class="header">
            <i class="fas fa-arrow-left" onclick="backToInbox()"></i>
            <div id="active-user-name" style="font-weight: bold;">چیٹ</div>
        </div>
        <div id="chat-flow"></div>
        <div id="sticker-panel">
            <div class="sticker-grid" id="sticker-list"></div>
        </div>
        <div class="footer">
            <div class="input-group">
                <i class="far fa-smile" style="color:#8696a0; cursor:pointer;" onclick="toggleStickers()"></i>
                <input type="text" id="msg-input" placeholder="میسج...">
            </div>
            <button onclick="sendText()" style="background:#00a884; border:none; width:40px; height:40px; border-radius:50%;"><i class="fas fa-paper-plane"></i></button>
        </div>
    </div>

</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, push, onChildAdded, off } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    const cfg = { databaseURL: "https://message-me-bbd25-default-rtdb.firebaseio.com/" };
    const app = initializeApp(cfg);
    const db = getDatabase(app);

    let myPhone = localStorage.getItem('user_phone') || "";
    let myName = localStorage.getItem('user_name') || "";
    let currentRoom = "";

    const stickers = [
        "https://cdn-icons-png.flaticon.com/512/4730/4730620.png",
        "https://cdn-icons-png.flaticon.com/512/4730/4730617.png",
        "https://cdn-icons-png.flaticon.com/512/12102/12102874.png",
        "https://cdn-icons-png.flaticon.com/512/11500/11500405.png"
    ];

    window.onload = () => {
        if(myPhone) {
            document.getElementById('login-screen').classList.remove('active');
            document.getElementById('list-screen').classList.add('active');
            renderInbox();
        }
        loadStickers();
    };

    window.registerUser = () => {
        const n = document.getElementById('reg-name').value.trim();
        const p = document.getElementById('reg-phone').value.trim();
        if(!n || !p) return alert("براہ کرم مکمل معلومات دیں!");
        localStorage.setItem('user_name', n);
        localStorage.setItem('user_phone', p);
        location.reload();
    };

    function loadStickers() {
        const list = document.getElementById('sticker-list');
        stickers.forEach(s => {
            const img = document.createElement('img');
            img.src = s; img.className = 'sticker-img';
            img.onclick = () => sendMsg(s, 'sticker');
            list.appendChild(img);
        });
    }

    window.showNewChat = () => {
        const room = prompt("کس کے ساتھ چیٹ کرنا چاہتے ہیں؟ (روم کوڈ لکھیں)");
        if(room) openChat(room);
    };

    window.openChat = (roomId) => {
        currentRoom = btoa(roomId);
        document.getElementById('list-screen').classList.remove('active');
        document.getElementById('chat-screen').classList.add('active');
        document.getElementById('active-user-name').innerText = roomId;
        
        // ہسٹری میں شامل کریں
        let chats = JSON.parse(localStorage.getItem('my_chats') || "[]");
        if(!chats.includes(roomId)) {
            chats.push(roomId);
            localStorage.setItem('my_chats', JSON.stringify(chats));
        }

        const flow = document.getElementById('chat-flow');
        flow.innerHTML = "";
        const chatRef = ref(db, "messages/" + currentRoom);
        off(chatRef);
        onChildAdded(chatRef, snap => {
            const d = snap.val();
            const isMe = d.phone === myPhone;
            flow.innerHTML += `
                <div class="msg ${isMe?'sent':'received'} ${d.type==='sticker'?'stk':''}" style="${d.type==='sticker'?'background:transparent; box-shadow:none;':''}">
                    ${!isMe ? `<span style="font-size:10px; color:#00a884; display:block;">${d.user}</span>`:''}
                    ${d.type==='sticker'?`<img src="${d.msg}" width="100">`:d.msg}
                    <div class="meta">${d.time}</div>
                </div>`;
            flow.scrollTop = flow.scrollHeight;
        });
    };

    window.sendText = () => {
        const inp = document.getElementById('msg-input');
        if(inp.value.trim()) { sendMsg(inp.value, 'text'); inp.value = ""; }
    };

    function sendMsg(msg, type) {
        push(ref(db, "messages/" + currentRoom), {
            phone: myPhone, user: myName, msg: msg, type: type,
            time: new Date().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'})
        });
        document.getElementById('sticker-panel').style.display = 'none';
    }

    window.toggleStickers = () => {
        const p = document.getElementById('sticker-panel');
        p.style.display = p.style.display === 'block' ? 'none' : 'block';
    };

    window.backToInbox = () => {
        document.getElementById('chat-screen').classList.remove('active');
        document.getElementById('list-screen').classList.add('active');
        renderInbox();
    };

    function renderInbox() {
        const list = document.getElementById('inbox-list');
        const chats = JSON.parse(localStorage.getItem('my_chats') || "[]");
        list.innerHTML = chats.length ? "" : "<p style='padding:20px; text-align:center; color:#8696a0;'>چیٹ شروع کرنے کے لیے بٹن دبائیں</p>";
        chats.forEach(c => {
            list.innerHTML += `<div class="chat-item" onclick="openChat('${c}')">
                <div class="avatar">${c.charAt(0)}</div>
                <div style="margin-left:15px;">
                    <div style="font-weight:bold;">${c}</div>
                    <div style="font-size:12px; color:#aebac1;">ٹیپ کریں اور بات کریں</div>
                </div>
            </div>`;
        });
    }
</script>
</body>
    </html>
    
