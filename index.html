<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>WhatsApp Nasir v170</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <style>
        :root { --wa-teal: #075e54; --wa-green: #25d366; --bg-app: #e5ddd5; --msg-sent: #dcf8c6; --msg-recv: #ffffff; --text: #000; }
        .dark-theme { --wa-teal: #1f2c33; --bg-app: #0b141a; --msg-sent: #005c4b; --msg-recv: #202c33; --text: #fff; }
        
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: sans-serif; user-select: none; }
        .selectable { user-select: text !important; } /* Only messages are selectable */

        body, html { height: 100%; width: 100%; overflow: hidden; background: var(--bg-app); color: var(--text); }

        /* Header & Search */
        .header { background: var(--wa-teal); color: white; padding: 10px 15px; display: flex; align-items: center; justify-content: space-between; height: 60px; }
        .search-bar { display: none; background: white; padding: 5px 10px; border-radius: 20px; margin: 10px; }
        .search-bar input { border: none; outline: none; width: 100%; }

        /* Chat Window */
        #chat-flow { flex: 1; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; gap: 10px; padding-bottom: 100px; }
        
        /* Message Logic */
        .msg-container { display: flex; flex-direction: column; max-width: 80%; position: relative; }
        .msg { padding: 8px 12px; border-radius: 10px; background: var(--msg-recv); color: var(--text); position: relative; font-size: 15px; box-shadow: 0 1px 2px rgba(0,0,0,0.2); }
        .sent { align-self: flex-end; background: var(--msg-sent); }
        .msg-info { display: flex; justify-content: flex-end; gap: 4px; font-size: 10px; color: gray; margin-top: 2px; }
        .blue-tick { color: #34b7f1; }

        /* Footer & Input */
        .footer { background: transparent; padding: 8px; display: flex; align-items: flex-end; position: fixed; bottom: 0; width: 100%; z-index: 2000; gap: 8px; }
        .pill { background: white; border-radius: 25px; flex: 1; display: flex; align-items: center; padding: 0 10px; min-height: 48px; box-shadow: 0 1px 2px rgba(0,0,0,0.2); max-width: calc(100% - 60px); }
        #msg-in { flex: 1; border: none; outline: none; padding: 10px; font-size: 16px; background: transparent; text-align: left; }
        
        .action-btn { background: #00a884; color: white; width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 22px; cursor: pointer; }

        /* Feature Menus */
        .pop-menu { display: none; position: fixed; bottom: 70px; left: 15px; background: white; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.3); z-index: 3000; width: 200px; overflow: hidden; }
        .menu-item { padding: 12px 15px; display: flex; align-items: center; gap: 12px; border-bottom: 1px solid #f0f0f0; cursor: pointer; color: #333; font-size: 14px; }
        .menu-item i { color: var(--wa-teal); width: 20px; }

        /* Emoji & Sticker Panel */
        #media-panel { display: none; background: white; position: fixed; bottom: 0; width: 100%; height: 300px; z-index: 4000; border-top: 1px solid #ddd; }
        .tab-bar { display: flex; justify-content: space-around; background: #f0f0f0; padding: 10px; }
        .tab-content { padding: 15px; display: grid; grid-template-columns: repeat(6, 1fr); gap: 10px; overflow-y: auto; height: 240px; }
        .sticker { width: 100%; cursor: pointer; }

        /* Reply Preview */
        #reply-preview { display: none; background: #eee; padding: 8px; border-left: 4px solid var(--wa-teal); margin: 5px; border-radius: 5px; }
    </style>
</head>
<body onclick="closeAll()">

<div id="app-container">
    <div class="header">
        <div style="display:flex; align-items:center; gap:10px;">
            <i class="fas fa-arrow-left"></i>
            <div>
                <b id="chat-name">Nasir Messenger</b><br>
                <small id="status">Online</small>
            </div>
        </div>
        <div style="display:flex; gap:15px;">
            <i class="fas fa-search" onclick="toggleSearch()"></i>
            <i class="fas fa-moon" onclick="toggleTheme()"></i>
            <i class="fas fa-ellipsis-v" onclick="toggleMainMenu()"></i>
        </div>
    </div>

    <div id="search-bar" class="search-bar">
        <input type="text" placeholder="Search messages..." oninput="searchMsg(this.value)">
    </div>

    <div id="chat-flow"></div>

    <div id="reply-preview">
        <small id="reply-text"></small>
        <i class="fas fa-times" style="float:right" onclick="cancelReply()"></i>
    </div>

    <div id="plus-menu" class="pop-menu">
        <div class="menu-item" onclick="document.getElementById('f-in').click()"><i class="fas fa-file"></i> Document / File</div>
        <div class="menu-item" onclick="sendLocation('current')"><i class="fas fa-map-marker-alt"></i> Current Location</div>
        <div class="menu-item" onclick="sendLocation('live')"><i class="fas fa-satellite"></i> Live Location</div>
        <div class="menu-item" onclick="clearChat()"><i class="fas fa-trash"></i> Delete Chat</div>
    </div>

    <div class="footer" onclick="event.stopPropagation()">
        <div class="pill">
            <i class="far fa-smile icon-btn" onclick="toggleMedia('emoji')"></i>
            <input type="text" id="msg-in" placeholder="Type a message..." oninput="upUI()">
            <i class="fas fa-plus icon-btn" style="margin: 0 10px; color: var(--wa-teal);" onclick="togglePlusMenu()"></i>
            <i class="fas fa-camera icon-btn" onclick="document.getElementById('f-in').click()"></i>
            <input type="file" id="f-in" style="display:none" onchange="upFile(this)">
        </div>
        <div class="action-btn" onclick="handleAction()">
            <i class="fas fa-microphone" id="mic-i"></i>
            <i class="fas fa-paper-plane" id="send-i" style="display:none"></i>
        </div>
    </div>

    <div id="media-panel">
        <div class="tab-bar">
            <span onclick="showTab('emoji')">üòä Emoji</span>
            <span onclick="showTab('sticker')">üñºÔ∏è Stickers</span>
        </div>
        <div id="tab-emoji" class="tab-content"></div>
        <div id="tab-sticker" class="tab-content" style="display:none"></div>
        <button onclick="toggleMedia()" style="width:100%; padding:10px; background:#f0f0f0; border:none;">Close</button>
    </div>
</div>

<script>
    let isDark = false;
    let replyID = null;

    // 1. Theme Toggle
    function toggleTheme() {
        document.body.classList.toggle('dark-theme');
        isDark = !isDark;
    }

    // 2. Search Logic
    function toggleSearch() {
        let bar = document.getElementById('search-bar');
        bar.style.display = bar.style.display === 'block' ? 'none' : 'block';
    }
    function searchMsg(val) {
        let msgs = document.querySelectorAll('.msg');
        msgs.forEach(m => {
            m.parentElement.style.display = m.innerText.toLowerCase().includes(val.toLowerCase()) ? 'flex' : 'none';
        });
    }

    // 3. Right Side Logic & UI
    function upUI() {
        let v = document.getElementById('msg-in').value.trim();
        document.getElementById('send-i').style.display = v ? 'block' : 'none';
        document.getElementById('mic-i').style.display = v ? 'none' : 'block';
    }

    // 4. Message Rendering with Selection & React
    function renderMsg(text, type, sender) {
        let flow = document.getElementById('chat-flow');
        let container = document.createElement('div');
        container.className = "msg-container " + (sender === 'me' ? 'sent' : '');
        
        let msg = document.createElement('div');
        msg.className = "msg selectable";
        msg.innerText = text;
        msg.onclick = () => showMessageOptions(text); // Reaction/Reply on click

        let info = document.createElement('div');
        info.className = "msg-info";
        info.innerHTML = `12:00 PM <i class="fas fa-check-double blue-tick"></i>`;

        container.appendChild(msg);
        container.appendChild(info);
        flow.appendChild(container);
        flow.scrollTop = flow.scrollHeight;
    }

    function handleAction() {
        let inp = document.getElementById('msg-in');
        if(inp.value.trim()) {
            renderMsg(inp.value, 'text', 'me');
            inp.value = "";
            upUI();
            cancelReply();
        } else {
            alert("Recording started... (Simulated)");
        }
    }

    // 5. Menu Controls
    function togglePlusMenu() {
        let m = document.getElementById('plus-menu');
        m.style.display = m.style.display === 'block' ? 'none' : 'block';
    }

    function toggleMedia(type) {
        let p = document.getElementById('media-panel');
        p.style.display = p.style.display === 'block' ? 'none' : 'block';
        if(type) showTab(type);
    }

    function showTab(t) {
        document.getElementById('tab-emoji').style.display = t === 'emoji' ? 'grid' : 'none';
        document.getElementById('tab-sticker').style.display = t === 'sticker' ? 'grid' : 'none';
    }

    function showMessageOptions(text) {
        let act = confirm("Do you want to Reply to this message?");
        if(act) {
            document.getElementById('reply-preview').style.display = 'block';
            document.getElementById('reply-text').innerText = text;
            document.getElementById('msg-in').focus();
        }
    }

    function cancelReply() {
        document.getElementById('reply-preview').style.display = 'none';
    }

    // Initial Emojis & Stickers
    const ems = ["üòä","üòÇ","‚ù§Ô∏è","üòç","üëç","üôè","üî•","üåπ","‚úÖ","üìç"];
    ems.forEach(e => {
        let d = document.createElement('div'); d.innerText = e; d.style.fontSize="25px";
        d.onclick = () => { document.getElementById('msg-in').value += e; upUI(); };
        document.getElementById('tab-emoji').appendChild(d);
    });

    const sticks = ["https://cdn-icons-png.flaticon.com/512/2584/2584606.png", "https://cdn-icons-png.flaticon.com/512/2584/2584602.png"];
    sticks.forEach(s => {
        let img = document.createElement('img'); img.src = s; img.className="sticker";
        img.onclick = () => renderMsg("Sticker Sent", 'img', 'me');
        document.getElementById('tab-sticker').appendChild(img);
    });

    function closeAll() {
        document.getElementById('plus-menu').style.display = 'none';
    }
</script>
</body>
            </html>
    
